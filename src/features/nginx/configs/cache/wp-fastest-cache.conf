# ğŸš€ WP Fastest Cache Configuration




location / {
    error_page 418 = @cachemiss;
    error_page 419 = @mobileaccess;
    recursive_error_pages on;

    set $pathDomain "/wp-content/cache/${host}/all${uri}";
    set $path "/wp-content/cache/all${uri}";

    # ğŸ”¥ KhÃ´ng cache POST requests
    if ($request_method = POST) { return 418; }

    # ğŸ”¥ KhÃ´ng cache khi cÃ³ query string (tÃ¬m kiáº¿m, bÃ i viáº¿t cá»¥ thá»ƒ)
    if ($arg_s != "") { return 418; }
    if ($arg_p != "") { return 418; }

    # ğŸ”¥ KhÃ´ng cache náº¿u ngÆ°á»i dÃ¹ng Ä‘Äƒng nháº­p
    if ($http_cookie ~* "wordpress_logged_in") { return 418; }

    # ğŸ”¥ KhÃ´ng cache WooCommerce giá» hÃ ng, thanh toÃ¡n
    if ($http_cookie ~* "woocommerce_items_in_cart|woocommerce_cart_hash|wp_woocommerce_session") { return 418; }

    # ğŸ”¥ Kiá»ƒm tra file cache tá»“n táº¡i
    try_files $pathDomain/index.html $path/index.html @cachemiss;

    # ${CHECKMARK} ThÃªm HTTP Header kiá»ƒm tra cache HIT/MISS
    add_header X-Cache-Status $upstream_cache_status always;
}

# ${CHECKMARK} Náº¿u cache MISS, chuyá»ƒn Ä‘áº¿n PHP
location @cachemiss {
    include /usr/local/openresty/nginx/conf/globals/php.conf;
    try_files $uri $uri/ /index.php?$args;
    # ${CHECKMARK} Náº¿u cache MISS, hiá»ƒn thá»‹ header MISS
    add_header X-Cache-Status "MISS" always;
}

# ${CHECKMARK} Cache riÃªng cho thiáº¿t bá»‹ di Ä‘á»™ng
location @mobileaccess {
    set $path "/wp-content/cache/mobile${uri}";
    try_files $path/index.html @cachemiss;
}
